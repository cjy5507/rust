# 롤렉스 자동화 시스템 - 고급 기능 가이드

## 🚀 새로운 자동화 기능 개요

### 주요 개선사항
1. **시간 기반 자동화**: 설정된 시간까지 대기 후 정확한 타이밍에 자동화 시작
2. **지능형 PASS 인증**: 통신사 선택, 전체 동의, QR 코드 인증 자동 처리
3. **네트워크 안정성**: 렉 발생 시 자동 새로고침 및 복구
4. **스마트 시간/날짜 선택**: 설정값과 유사한 옵션 자동 선택
5. **롤렉스 컬렉션 자동 진입**: 시작 시간에 맞춰 컬렉션 페이지 접근

## 📋 자동화 플로우

### 1단계: 페이지 접속 및 대기(시작버튼 누름과 동시 실행)
- 초기 쿠키팝업이 있을경우 자동으로 닫기
- 시작 버튼 누름과 동시에 실행
- 롤렉스 매장 인증 페이지 접속
- 페이지 로딩 완료까지 지능형 대기
- 롤렉스 컬렉션 버튼 감지 및 대기

### 2단계: 시간 기반 실행
```
설정된 시작 시간까지 대기
예: 10:00 설정 시 → 09:59:59까지 대기 → 10:00:00에 정확히 시작
```

### 3단계: 롤렉스 컬렉션 접근
- "롤렉스 컬렉션" 또는 "컬렉션 살펴보기" 버튼 클릭
- 동의 버튼 자동 클릭
- 다음 단계로 자동 진행

### 4단계: PASS 인증 처리
```
통신사 선택 → 전체 동의하기 → 인증하기 → QR 코드 인증 → 팝업 종료 대기
```

### 5단계: 예약 페이지 처리
- 날짜/시간 스마트 선택 (±3일, ±30분 범위에서 유사한 값 찾기)
- 예약하기 버튼 클릭
- 이메일 폼 자동 입력 및 제출

## ⚙️ 설정 가이드

### 자동화 시작 시간 설정
1. **설정 페이지** → **매장별 예약 설정**
2. **자동화 시작 시간** 선택 (1분 단위로 정밀 설정 가능)
3. 예: `10:00` 설정 시 정확히 오전 10시에 자동화 시작

### 통신사 설정
- SKT, KT, LGU+ 지원
- PASS 인증 시 자동으로 해당 통신사 선택

### 날짜/시간 설정
- **방문 날짜**: 캘린더에서 원하는 날짜 선택
- **방문 시간**: 24시간 형식으로 시간 선택
- 시스템이 유사한 시간대 자동 선택 (정확한 시간이 없을 경우)

## 🔧 네트워크 안정성 기능

### 자동 복구 시스템
- 페이지 로딩 실패 시 자동 새로고침
- 네트워크 오류 감지 및 복구
- 렉 발생 시 지능형 재시도

### 팝업 모니터링
- PASS 인증 팝업 상태 실시간 모니터링
- 팝업 종료 자동 감지
- 인증 완료 후 다음 단계 자동 진행

## 📱 사용자 개입 시점

### 필수 개입 시점
1. **QR 코드 인증**: 모바일 앱에서 QR 코드 스캔 필요
2. **추가 인증**: 특별한 보안 검증이 요구되는 경우

### 자동 처리 항목
- 통신사 선택
- 전체 동의하기
- 날짜/시간 선택
- 이메일 입력
- 폼 제출

## 🚨 오류 처리 및 복구

### 지능형 재시도
```rust
// 최대 3회 재시도, 지수 백오프 적용
intelligent_retry(operation, 3, "페이지 로딩").await?;
```

### 네트워크 상태 확인
- 페이지 응답성 실시간 모니터링
- 오류 페이지 감지 시 자동 새로고침
- 브라우저 안정성 지속적 체크

### 사용자 피드백
- 실시간 로그 출력
- 단계별 진행 상황 표시
- 오류 발생 시 상세 정보 제공

## 📊 성능 최적화

### 브라우저 설정
```rust
LaunchOptions {
    headless: false,
    window_size: Some((1200, 800)),
    sandbox: false,  // 빠른 시작
    idle_browser_timeout: Duration::from_secs(600),  // 10분 타임아웃
    args: vec![
        "--disable-web-security",
        "--disable-features=VizDisplayCompositor",
        "--no-first-run",
        "--disable-default-apps",
        "--disable-popup-blocking",  // PASS 인증용
    ],
}
```

### 성능 모니터링
- 페이지 로딩 시간 추적
- 메모리 사용량 모니터링
- 10초 이상 로딩 시 경고

## 🔐 보안 고려사항

### 개인정보 보호
- 비밀번호 암호화 저장
- 로컬 스토리지 활용
- 네트워크 통신 최소화

### 안전한 자동화
- 사용자 승인 없는 개인정보 전송 금지
- 브라우저 수동 제어 가능
- 자동화 중지 기능 제공

## 📝 사용 예시

### 단일 매장 자동화
```typescript
const storeConfig = {
  storeName: "롤렉스 강남점",
  authUrl: "https://...",
  reserveUrl: "https://...",
  startTime: "10:00",      // 오전 10시 정확히 시작
  visitDate: "2025-05-30", // 방문 날짜
  visitTime: "14:00",      // 오후 2시 방문 희망
  carrier: "SKT",          // SKT 통신사
  email: "user@example.com"
};

await invoke('run_single_automation', { storeConfig });
```

### 다중 매장 병렬 실행
```typescript
const storeConfigs = [
  // 여러 매장 설정...
];

await invoke('run_multiple_automation', { storeConfigs });
```

## 🎯 성공률 향상 팁

1. **정확한 시간 설정**: 경쟁이 치열한 시간대는 정확한 타이밍 필수
2. **안정적인 네트워크**: 유선 인터넷 연결 권장
3. **브라우저 최적화**: 불필요한 확장 프로그램 비활성화
4. **모바일 앱 준비**: QR 코드 인증용 PASS 앱 미리 실행
5. **여러 매장 동시 실행**: 성공 확률 향상을 위한 병렬 처리

## 🔄 업데이트 내역

### v2.0.0 (2025-05-30)
- ✅ 시간 기반 자동화 시스템 추가
- ✅ PASS 인증 자동 처리 강화
- ✅ 네트워크 안정성 개선
- ✅ 스마트 시간/날짜 선택 기능
- ✅ 롤렉스 컬렉션 자동 진입
- ✅ 성능 모니터링 시스템
- ✅ 지능형 재시도 메커니즘

### 향후 계획
- 🔄 AI 기반 최적 시간 추천
- 🔄 성공률 통계 분석
- 🔄 알림 시스템 강화
- 🔄 다국어 지원
